import{u as t,s as E,p as N}from"./ui-Q70j82VI.js";const D="/api/register",h=new Date("2025-11-28T23:59:59"),r=(e,o=document)=>o.querySelector(e),i=r("#form"),c=r("#dni"),u=r("#nombre"),m=r("#correo"),p=r("#lugar"),v=r("#comun"),g=r("#celiacos"),I=r("#vegetarianos"),b=r("#veganos"),y=r("#totalNum"),f=r("#errorMsg"),d=r("#submitBtn");let a=!1;const l=e=>Number.isNaN(parseInt(e,10))?0:parseInt(e,10),L=e=>/\S+@\S+\.\S+/.test(e);function w(){const e=l(v.value)+l(g.value)+l(I.value)+l(b.value);return y.textContent=e,e<1?f.classList.remove("hidden"):f.classList.add("hidden"),e}function n(){const e=w(),o=a&&u.value.trim()!==""&&L(m.value)&&p.value.trim()!==""&&e>=1;d.disabled=!o}[v,g,I,b].forEach(e=>{e.addEventListener("input",n)});[u,m,p].forEach(e=>{e.addEventListener("input",n)});c.addEventListener("blur",async()=>{const e=c.value.trim();if(e){t.loading("Verificando DNI...");try{const{data:o,error:s}=await E.from("invitados").select("id, nombre, retiro").eq("dni",e).maybeSingle();if(t.close(),s||!o)return a=!1,n(),i.reset(),c.focus(),t.error("DNI no habilitado.");if(o.retiro===!0)return a=!1,n(),i.reset(),t.info("Este DNI ya retiró su entrada.");a=!0,n(),t.success("DNI validado correctamente."),u.focus()}catch(o){t.close(),a=!1,n(),t.error("Error al verificar el DNI."),i.reset(),c.focus(),console.error(o)}}});i.addEventListener("submit",async e=>{if(e.preventDefault(),new Date>h)return t.info("El período de registro ha finalizado.");if(d.disabled)return;const o=Object.fromEntries(new FormData(i).entries());try{t.loading("Enviando registro...");const s=await N(D,o);t.close(),t.success(s),console.log(s),i.reset(),a=!1,n()}catch(s){t.close(),t.error(s.message||"No se pudo completar el registro.")}});d.disabled=!0;n();r("#anio").textContent=new Date().getFullYear();c.focus();
