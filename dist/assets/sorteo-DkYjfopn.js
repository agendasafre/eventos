import{S as I,s as F}from"./sweetalert2.esm.all-D6Q_Y7Jt.js";function E(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Y(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,K(n.key),n)}}function N(e,i,t){return i&&Y(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function J(e,i){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,i);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function K(e){var i=J(e,"string");return typeof i=="symbol"?i:i+""}function R(e){return+e.replace(/px/,"")}function Q(e){var i=window.devicePixelRatio,t=getComputedStyle(e),n=R(t.getPropertyValue("width")),a=R(t.getPropertyValue("height"));e.setAttribute("width",(n*i).toString()),e.setAttribute("height",(a*i).toString())}function h(e,i){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Math.random()*(i-e)+e;return Math.floor(n*Math.pow(10,t))/Math.pow(10,t)}function j(e){return e[h(0,e.length)]}var Z=.00125,ee=5e-4,te=9e-4,ie=1e-5,ne=6,oe=80,ae=.9,se=1.7,re=.2,ce=.6,ue=.03,le=.07,k=15,z=82,O=150,fe=100,de=250,he=40,me=["#fcf403","#62fc03","#f4fc03","#03e7fc","#03fca5","#a503fc","#fc03ad","#fc03c2"];function M(e){var i=1920;return Math.log(e)/Math.log(i)}var S=(function(){function e(i){E(this,e);var t=i.initialPosition,n=i.confettiRadius,a=i.confettiColors,o=i.emojis,s=i.emojiSize,c=i.canvasWidth,r=i.initialFlightAngle,l=i.rotationAngle,f=i.shouldHideConfettiInShiftedPosition,u=f===void 0?!1:f,d=h(ae,se,3),m=d*M(c);this.confettiSpeed={x:m,y:m},this.finalConfettiSpeedX=h(re,ce,3),this.rotationSpeed=o.length?.01:h(ue,le,3)*M(c),this.dragForceCoefficient=h(ee,te,6),this.radius={x:n,y:n},this.initialRadius=n,this.rotationAngle=l,this.emojiSize=s,this.emojiRotationAngle=h(0,2*Math.PI),this.radiusYUpdateDirection="down",this.cos=Math.cos(r),this.sin=Math.sin(r);var v=h(-150,0);this.positionOffset={x:v*this.sin,y:v*this.cos},this.distanceTravelled={x:0,y:0};var p={x:t.x+this.positionOffset.x,y:t.y-this.positionOffset.y};this.currentPosition=Object.assign({},p),this.initialPosition=Object.assign({},p),this.color=o.length?null:j(a),this.emoji=o.length?j(o):null,this.createdAt=new Date().getTime(),this.isVisible=!u}return N(e,[{key:"draw",value:function(t){var n=this.currentPosition,a=this.radius,o=this.color,s=this.emoji,c=this.rotationAngle,r=this.emojiRotationAngle,l=this.emojiSize,f=this.isVisible;if(f){var u=window.devicePixelRatio;o?(t.fillStyle=o,t.beginPath(),t.ellipse(n.x*u,n.y*u,a.x*u,a.y*u,c,0,2*Math.PI),t.fill()):s&&(t.font="".concat(l,"px serif"),t.save(),t.translate(u*n.x,u*n.y),t.rotate(r),t.textAlign="center",t.fillText(s,0,0),t.restore())}}},{key:"updatePosition",value:function(t,n){var a=this.confettiSpeed,o=this.dragForceCoefficient,s=this.finalConfettiSpeedX,c=this.radiusYUpdateDirection,r=this.rotationSpeed,l=this.createdAt;a.x>s&&(this.confettiSpeed.x-=o*t);var f=this.currentPosition.y,u=n-l;this.currentPosition.y=this.initialPosition.y-a.y*this.cos*u+Z*Math.pow(u,2)/2;var d={x:a.x*this.sin*t,y:this.currentPosition.y-f};if(this.currentPosition.x+=d.x,this.distanceTravelled.x+=Math.abs(d.x),this.distanceTravelled.y+=Math.abs(d.y),this.distanceTravelled.x>=Math.abs(this.positionOffset.x)&&this.distanceTravelled.y>=Math.abs(this.positionOffset.y)&&(this.isVisible=!0),this.rotationSpeed-=this.emoji?1e-4:ie*t,this.rotationSpeed<0&&(this.rotationSpeed=0),this.emoji){this.emojiRotationAngle+=this.rotationSpeed*t%(2*Math.PI);return}c==="down"?(this.radius.y-=t*r,this.radius.y<=0&&(this.radius.y=0,this.radiusYUpdateDirection="up")):(this.radius.y+=t*r,this.radius.y>=this.initialRadius&&(this.radius.y=this.initialRadius,this.radiusYUpdateDirection="down"))}},{key:"getIsVisibleOnCanvas",value:function(t){return this.currentPosition.y<t+fe}}])})();function ve(){var e=document.createElement("canvas");return e.style.position="fixed",e.style.width="100%",e.style.height="100%",e.style.top="0",e.style.left="0",e.style.zIndex="1000",e.style.pointerEvents="none",document.body.appendChild(e),e}function x(e){var i=e.confettiRadius,t=i===void 0?ne:i,n=e.confettiNumber,a=n===void 0?e.confettiesNumber||(e.emojis?he:de):n,o=e.confettiColors,s=o===void 0?me:o,c=e.emojis,r=c===void 0?e.emojies||[]:c,l=e.emojiSize,f=l===void 0?oe:l,u=e.confettiDispatchPosition,d=u===void 0?null:u;return e.emojies&&console.error("emojies argument is deprecated, please use emojis instead"),e.confettiesNumber&&console.error("confettiesNumber argument is deprecated, please use confettiNumber instead"),{confettiRadius:t,confettiNumber:a,confettiColors:s,emojis:r,emojiSize:f,confettiDispatchPosition:d}}function P(e){return e*Math.PI/180}function pe(){return P(h(z,k))}function ge(){return P(h(-k,-z))}function Ce(){return P(h(-O,O))}function D(){return h(0,.2,3)}function Se(){return h(-.2,0,3)}var L=(function(){function e(i){var t=this;E(this,e),this.canvasContext=i,this.shapes=[],this.promise=new Promise(function(n){return t.resolvePromise=n})}return N(e,[{key:"getBatchCompletePromise",value:function(){return this.promise}},{key:"addShapes",value:function(){var t;(t=this.shapes).push.apply(t,arguments)}},{key:"complete",value:function(){var t;return this.shapes.length?!1:((t=this.resolvePromise)===null||t===void 0||t.call(this),!0)}},{key:"processShapes",value:function(t,n,a){var o=this,s=t.timeDelta,c=t.currentTime;this.shapes=this.shapes.filter(function(r){return r.updatePosition(s,c),r.draw(o.canvasContext),a?r.getIsVisibleOnCanvas(n):!0})}}])})(),Ie=(function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};E(this,e),this.activeConfettiBatches=[],this.canvas=i.canvas||ve(),this.canvasContext=this.canvas.getContext("2d"),this.requestAnimationFrameRequested=!1,this.lastUpdated=new Date().getTime(),this.iterationIndex=0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}return N(e,[{key:"loop",value:function(){this.requestAnimationFrameRequested=!1,Q(this.canvas);var t=new Date().getTime(),n=t-this.lastUpdated,a=this.canvas.offsetHeight,o=this.iterationIndex%10===0;this.activeConfettiBatches=this.activeConfettiBatches.filter(function(s){return s.processShapes({timeDelta:n,currentTime:t},a,o),o?!s.complete():!0}),this.iterationIndex++,this.queueAnimationFrameIfNeeded(t)}},{key:"queueAnimationFrameIfNeeded",value:function(t){this.requestAnimationFrameRequested||this.activeConfettiBatches.length<1||(this.requestAnimationFrameRequested=!0,this.lastUpdated=t||new Date().getTime(),requestAnimationFrame(this.loop))}},{key:"addConfettiAtPosition",value:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=x(t),a=n.confettiRadius,o=n.confettiNumber,s=n.confettiColors,c=n.emojis,r=n.emojiSize,l=n.confettiDispatchPosition,f=this.canvas.getBoundingClientRect(),u=f.width,d=new L(this.canvasContext),m=0;m<o;m++){var v=new S({initialPosition:l,confettiRadius:a,confettiColors:s,confettiNumber:o,emojis:c,emojiSize:r,canvasWidth:u,rotationAngle:D(),initialFlightAngle:Ce(),shouldHideConfettiInShiftedPosition:!0});d.addShapes(v)}return this.activeConfettiBatches.push(d),this.queueAnimationFrameIfNeeded(),d.getBatchCompletePromise()}},{key:"addConfetti",value:function(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=x(t),a=n.confettiRadius,o=n.confettiNumber,s=n.confettiColors,c=n.emojis,r=n.emojiSize,l=this.canvas.getBoundingClientRect(),f=l.width,u=l.height,d=u*5/7,m={x:0,y:d},v={x:f,y:d},p=new L(this.canvasContext),w=0;w<o/2;w++){var G=new S({initialPosition:m,confettiRadius:a,confettiColors:s,confettiNumber:o,emojis:c,emojiSize:r,canvasWidth:f,rotationAngle:D(),initialFlightAngle:pe()}),V=new S({initialPosition:v,confettiRadius:a,confettiColors:s,confettiNumber:o,emojis:c,emojiSize:r,canvasWidth:f,rotationAngle:Se(),initialFlightAngle:ge()});p.addShapes(V,G)}return this.activeConfettiBatches.push(p),this.queueAnimationFrameIfNeeded(),p.getBatchCompletePromise()}},{key:"clearCanvas",value:function(){this.activeConfettiBatches=[]}},{key:"destroyCanvas",value:function(){this.canvas.remove()}}])})();const ye="/assets/drumroll-BfAPJ4aK.mp3",_e="/assets/fanfare-DQO378cn.mp3",q="555255",Ae=sessionStorage.getItem("internal_key");async function U(){const{value:e}=await I.fire({title:"Acceso restringido",input:"password",inputLabel:"Ingresá la clave de acceso",inputPlaceholder:"••••••",confirmButtonText:"Entrar",background:"#f1faee",color:"#1d3557",allowOutsideClick:!1});return e===q?(sessionStorage.setItem("internal_key",e),!0):(await I.fire({icon:"error",title:"Clave incorrecta",text:"No tenés autorización para acceder.",confirmButtonColor:"#457b9d"}),U())}Ae!==q&&await U();document.body.classList.add("sorteo");const T=document.getElementById("slotText"),y=document.getElementById("btnStart"),$=document.getElementById("winner"),Ee=document.getElementById("winnerName"),b=document.getElementById("btnNext"),g=new Audio(ye),_=new Audio(_e);g.volume=.6;_.volume=.8;const A=new Ie,Ne=4500,Pe=45,B=120;let C=!1;const W=e=>new Promise(i=>setTimeout(i,e)),Te=e=>e*(2-e);function be(e){T.textContent=`Nº ${e.numero}`}function we(e){Ee.textContent=`Nº ${e.numero}`,$.classList.add("show")}function H(){$.classList.remove("show"),A.clearCanvas()}async function X(){if(C)return;C=!0,y.disabled=!0,H();const{data:e,error:i}=await F.from("entradas").select("numero").eq("entregado",!0).eq("sorteado",!1).order("numero",{ascending:!0});if(i||!e?.length)return C=!1,y.disabled=!1,I.fire("Sin elegibles","No quedan números disponibles.","info");const t=e.sort(()=>Math.random()-.5),n=t[Math.floor(Math.random()*t.length)];g.currentTime=0,g.play();const a=performance.now();let o=0;for(;;){const s=performance.now(),c=Math.min(1,(s-a)/Ne),r=B-(B-Pe)*Te(c),l=Math.floor(s/r)%10;if(l!==o&&(T.textContent=`Nº ${Math.floor(Math.random()*999)}`,o=l),c>=1)break;await W(16)}g.pause(),g.currentTime=0,be(n),we(n),_.currentTime=0,_.play(),A.addConfetti({emojis:["🎉","🥳","🎊"],emojiSize:42,confettiNumber:60}),A.addConfetti({confettiColors:["#f1faee","#1d3557","#e63946","#ffb703","#fb8500","#219ebc","#8ecae6","#8338ec","#06d6a0","#ffd166"],confettiRadius:6,confettiNumber:800}),await F.from("entradas").update({sorteado:!0}).eq("numero",n.numero),b.disabled=!1,C=!1}async function Fe(){b.disabled=!0,H(),T.textContent="Listo para sortear…",await W(500),X()}y.addEventListener("click",X);b.addEventListener("click",Fe);
