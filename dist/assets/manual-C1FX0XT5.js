import"./sweetalert2.esm.all-DP5jmEj0.js";import{u as o}from"./ui-BGBQetbT.js";const l="555255",C="/api/manual",t=(e,c=document)=>c.querySelector(e);async function b(){const{value:e}=await Swal.fire({title:"Acceso restringido",input:"password",inputLabel:"Ingresá la clave interna",inputPlaceholder:"••••••",confirmButtonText:"Entrar",background:"#f1faee",color:"#1d3557",allowOutsideClick:!1});return e===l?(sessionStorage.setItem("internal_key",e),!0):(await Swal.fire({icon:"error",title:"Clave incorrecta",confirmButtonColor:"#457b9d"}),b())}const S=sessionStorage.getItem("internal_key");S!==l&&await b();const E=t("#dni"),y=t("#nombre"),w=t("#correo"),N=t("#lugar"),u=t("#comun"),d=t("#celiacos"),m=t("#vegetarianos"),p=t("#veganos"),I=t("#totalNum"),h=t("#form"),L=t("#limpiarBtn"),s=t("#resultado"),a=e=>Number.isNaN(parseInt(e,10))?0:parseInt(e,10);function i(){const e=a(u.value)+a(d.value)+a(m.value)+a(p.value);return I.textContent=e,e}[u,d,m,p].forEach(e=>e.addEventListener("input",i));i();L.addEventListener("click",()=>{h.reset(),i(),s.classList.add("hidden"),s.textContent=""});h.addEventListener("submit",async e=>{e.preventDefault();const c=i();if(!y.value.trim()||!w.value.trim())return o.info("Completá nombre y correo");if(c<1)return o.info("Seleccioná al menos un menú");const k={dni:E.value.trim()||null,nombre:y.value.trim(),correo:w.value.trim(),lugar:N.value.trim()||null,comun:a(u.value),celiacos:a(d.value),vegetarianos:a(m.value),veganos:a(p.value),enviar_mail:!0};try{o.loading("Guardando invitado...");const n=await fetch(C,{method:"POST",headers:{"Content-Type":"application/json","X-Internal-Key":l||""},body:JSON.stringify(k)}),v=(n.headers.get("content-type")||"").includes("application/json"),g=v?await n.text():await n.text();let r;try{r=v?JSON.parse(g||"{}"):{}}catch{r={}}if(o.close(),!n.ok)throw new Error(r?.error||g||"Error al guardar");const f=`${location.origin}/mesas.html?token=${encodeURIComponent(r.mesa_token)}`;s.innerHTML=`
      <div>
        <p><b>${r.message||"Invitado guardado"}</b></p>
        <p class="mt-1">Token de mesas: <code>${r.mesa_token||""}</code></p>
        <p class="mt-1">Link de selección de mesas:</p>
        <p class="truncate"><a href="${f}" class="text-azul underline" target="_blank">${f}</a></p>
      </div>
    `,s.classList.remove("hidden"),o.success("Listo. Copiá el link para enviar.")}catch(n){o.close(),console.error(n),o.error(n.message||"No se pudo guardar")}});t("#anio").textContent=new Date().getFullYear();
