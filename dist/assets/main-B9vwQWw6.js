import"./sweetalert2.esm.all-C9HRBEaT.js";import{s as E}from"./supabase-CFADINa5.js";import{p as N}from"./api-Ddpk_UT3.js";import{u as t}from"./ui-DQSecMIg.js";const D="/api/register",h=new Date("2025-11-28T23:59:59"),r=(e,o=document)=>o.querySelector(e),i=r("#form"),c=r("#dni"),u=r("#nombre"),d=r("#correo"),p=r("#lugar"),v=r("#comun"),g=r("#celiacos"),b=r("#vegetarianos"),I=r("#veganos"),y=r("#totalNum"),f=r("#errorMsg"),m=r("#submitBtn");let a=!1;const l=e=>Number.isNaN(parseInt(e,10))?0:parseInt(e,10),L=e=>/\S+@\S+\.\S+/.test(e);function w(){const e=l(v.value)+l(g.value)+l(b.value)+l(I.value);return y.textContent=e,e<1?f.classList.remove("hidden"):f.classList.add("hidden"),e}function n(){const e=w(),o=a&&L(d.value)&&p.value.trim()!==""&&e>=1;m.disabled=!o}[v,g,b,I].forEach(e=>{e.addEventListener("input",n)});[d,p].forEach(e=>{e.addEventListener("input",n)});c.addEventListener("blur",async()=>{const e=c.value.trim();if(e){t.loading("Verificando DNI...");try{const{data:o,error:s}=await E.from("invitados").select("id, nombre, retiro").eq("dni",e).maybeSingle();if(t.close(),s||!o)return a=!1,n(),i.reset(),c.focus(),t.error("DNI no habilitado.");if(o.retiro===!0)return a=!1,n(),i.reset(),t.info("Este DNI ya retiró su entrada.");u.value=o.nombre||"",u.disabled=!0,a=!0,n(),t.success("DNI validado correctamente."),d.focus()}catch(o){t.close(),a=!1,n(),t.error("Error al verificar el DNI."),i.reset(),c.focus(),console.error(o)}}});i.addEventListener("submit",async e=>{if(e.preventDefault(),new Date>h)return t.info("El período de registro ha finalizado.");if(m.disabled)return;const o=Object.fromEntries(new FormData(i).entries());try{t.loading("Enviando registro...");const s=await N(D,o);t.close(),t.success(s),console.log(s),i.reset(),a=!1,n()}catch(s){t.close(),t.error(s.message||"No se pudo completar el registro.")}});m.disabled=!0;n();r("#anio").textContent=new Date().getFullYear();c.focus();u.disabled=!0;
