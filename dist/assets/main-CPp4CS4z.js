import{u as t,s as N}from"./ui-Cf0ssn9_.js";async function h(e,o){const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),f=await n.text();if(!n.ok)throw new Error(f);return f}const y="/api/register",D=new Date("2025-11-28T23:59:59"),r=(e,o=document)=>o.querySelector(e),i=r("#form"),c=r("#dni"),u=r("#nombre"),p=r("#correo"),v=r("#lugar"),g=r("#comun"),I=r("#celiacos"),b=r("#vegetarianos"),E=r("#veganos"),w=r("#totalNum"),m=r("#errorMsg"),d=r("#submitBtn");let a=!1;const l=e=>Number.isNaN(parseInt(e,10))?0:parseInt(e,10),S=e=>/\S+@\S+\.\S+/.test(e);function L(){const e=l(g.value)+l(I.value)+l(b.value)+l(E.value);return w.textContent=e,e<1?m.classList.remove("hidden"):m.classList.add("hidden"),e}function s(){const e=L(),o=a&&u.value.trim()!==""&&S(p.value)&&v.value.trim()!==""&&e>=1;d.disabled=!o}[g,I,b,E].forEach(e=>{e.addEventListener("input",s)});[u,p,v].forEach(e=>{e.addEventListener("input",s)});c.addEventListener("blur",async()=>{const e=c.value.trim();if(e){t.loading("Verificando DNI...");try{const{data:o,error:n}=await N.from("invitados").select("id, nombre, retiro").eq("dni",e).maybeSingle();if(t.close(),n||!o)return a=!1,s(),i.reset(),c.focus(),t.error("DNI no habilitado.");if(o.retiro===!0)return a=!1,s(),i.reset(),t.info("Este DNI ya retiró su entrada.");a=!0,s(),t.success("DNI validado correctamente."),u.focus()}catch(o){t.close(),a=!1,s(),t.error("Error al verificar el DNI."),i.reset(),c.focus(),console.error(o)}}});i.addEventListener("submit",async e=>{if(e.preventDefault(),new Date>D)return t.info("El período de registro ha finalizado.");if(d.disabled)return;const o=Object.fromEntries(new FormData(i).entries());try{t.loading("Enviando registro...");const n=await h(y,o);t.close(),t.success(n),console.log(n),i.reset(),a=!1,s()}catch(n){t.close(),t.error(n.message||"No se pudo completar el registro.")}});d.disabled=!0;s();r("#anio").textContent=new Date().getFullYear();c.focus();
