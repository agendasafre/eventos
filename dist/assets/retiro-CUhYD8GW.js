import{u as e,s as I}from"./ui-C3ZGStvc.js";import{p as b}from"./api-Ddpk_UT3.js";const E="/api/retirar",h=new Date("2025-11-28T23:59:59"),o=(n,r=document)=>r.querySelector(n),f=o("#form"),p=o("#dni"),s=o("#retiroSection"),i=o("#comun"),l=o("#celiacos"),u=o("#vegetarianos"),d=o("#veganos"),g=o("#submitBtn");let t=null;const a=n=>Number.isNaN(parseInt(n,10))?0:parseInt(n,10);function m(){const n=a(i.value)+a(l.value)+a(u.value)+a(d.value);return g.disabled=!(t&&n>0),n}[i,l,u,d].forEach(n=>n.addEventListener("input",m));p.addEventListener("blur",async()=>{const n=p.value.trim();if(n){e.loading("Verificando DNI...");try{const{data:r,error:v}=await I.from("invitados").select("*").eq("dni",n).maybeSingle();if(e.close(),v||!r)return t=null,s.classList.add("hidden"),e.error("DNI no encontrado o no habilitado.");if(r.retiro===!0)return t=null,s.classList.add("hidden"),e.info("Este invitado ya retiró sus entradas.");t=r,s.classList.remove("hidden"),i.value=r.opciones_comun||0,l.value=r.opciones_celiacos||0,u.value=r.opciones_vegetarianos||0,d.value=r.opciones_veganos||0,m(),e.success(`Invitado: ${r.nombre}`),i.focus()}catch(r){e.close(),s.classList.add("hidden"),t=null,e.error("Error al verificar el DNI."),console.error(r)}}});f.addEventListener("submit",async n=>{if(n.preventDefault(),!t)return e.error("Primero validá un DNI.");if(m()<1)return e.error("Debés registrar al menos un menú retirado.");if(new Date>h)return e.info("⏰ El período de retiro ha finalizado.");const v={dni:t.dni,comun:a(i.value),celiacos:a(l.value),vegetarianos:a(u.value),veganos:a(d.value)};try{e.loading("Registrando retiro...");const c=await b(E,v);e.close(),e.success(c),f.reset(),s.classList.add("hidden"),t=null,g.disabled=!0}catch(c){e.close(),e.error(c.message||"Error al confirmar el retiro."),console.error(c)}});o("#anio").textContent=new Date().getFullYear();
