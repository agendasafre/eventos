import{S as r}from"./sweetalert2.esm.all-GP8esQtv.js";import{s as C}from"./supabase-CFADINa5.js";const E="/assets/drumroll-BfAPJ4aK.mp3",T="/assets/fanfare-DQO378cn.mp3",S="4",B=sessionStorage.getItem("internal_key");async function h(){const{value:e}=await r.fire({title:"Acceso restringido",input:"password",inputLabel:"IngresÃ¡ la clave de acceso",inputPlaceholder:"â€¢â€¢â€¢â€¢â€¢â€¢",confirmButtonText:"Entrar",background:"#f1faee",color:"#1d3557",allowOutsideClick:!1});return e===S?(sessionStorage.setItem("internal_key",e),!0):(await r.fire({icon:"error",title:"Clave incorrecta",text:"No tenÃ©s autorizaciÃ³n para acceder.",confirmButtonColor:"#457b9d"}),h())}B!==S&&await h();document.body.classList.add("sorteo");const l=document.getElementById("slotText"),s=document.getElementById("btnStart"),y=document.getElementById("winner"),_=document.getElementById("winnerName"),d=document.getElementById("btnNext"),t=new Audio(E),i=new Audio(T);t.volume=.6;i.volume=.8;const b=window.JSConfetti||globalThis.JSConfetti,c=b?new b:{addConfetti:()=>{},clearCanvas:()=>{}},k=4500,A=45,g=120;let n=!1;const x=e=>new Promise(o=>setTimeout(o,e)),L=e=>e*(2-e);function K(e){l.textContent=`NÂº ${e.numero}`}function q(e){_.textContent=`NÂº ${e.numero}`,y.classList.add("show")}function I(){y.classList.remove("show"),c.clearCanvas()}async function N(){if(n)return;n=!0,s.disabled=!0,I();const{data:e,error:o}=await C.from("entradas").select("numero").eq("entregado",!0).eq("sorteado",!1).order("numero",{ascending:!0});if(o||!e?.length)return n=!1,s.disabled=!1,r.fire("Sin elegibles","No quedan nÃºmeros disponibles.","info");const f=e.sort(()=>Math.random()-.5),a=f[Math.floor(Math.random()*f.length)];t.currentTime=0,t.play();const v=performance.now();let u=0;for(;;){const m=performance.now(),w=Math.min(1,(m-v)/k),M=g-(g-A)*L(w),p=Math.floor(m/M)%10;if(p!==u&&(l.textContent=`NÂº ${Math.floor(Math.random()*999)}`,u=p),w>=1)break;await x(16)}t.pause(),t.currentTime=0,K(a),q(a),i.currentTime=0,i.play(),c.addConfetti({emojis:["ðŸŽ‰","ðŸ¥³","ðŸŽŠ"],emojiSize:42,confettiNumber:60}),c.addConfetti({confettiColors:["#f1faee","#1d3557","#e63946","#ffb703","#fb8500","#219ebc","#8ecae6","#8338ec","#06d6a0","#ffd166"],confettiRadius:6,confettiNumber:800}),await C.from("entradas").update({sorteado:!0}).eq("numero",a.numero),d.disabled=!1,n=!1}async function J(){d.disabled=!0,I(),l.textContent="Listo para sortearâ€¦",await x(500),N()}s.addEventListener("click",N);d.addEventListener("click",J);
